<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FDA RTR – Module 3</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- ACCESS GATE -->
<div id="accessGate" class="min-h-screen flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">Authorized Access Only</h2>

    <input id="accessId"
      class="border p-2 w-full mb-3"
      placeholder="Access ID">

    <input id="accessKey"
      type="password"
      class="border p-2 w-full mb-4"
      placeholder="Access Key">

    <button onclick="validateAccess()"
      class="bg-blue-600 text-white px-4 py-2 rounded w-full">
      Enter System
    </button>

    <p id="accessError" class="text-red-600 mt-3 hidden">
      Invalid credentials.
    </p>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden max-w-4xl mx-auto p-6">

  <h1 class="text-3xl font-bold mb-6 text-gray-800">
    FDA RTR – CTD Module 3 Checker
  </h1>

  <!-- MAIN SECTION SELECTOR -->
  <div class="flex space-x-4 mb-3">
    <button onclick="selectMainSection('ds')"
      class="px-4 py-2 bg-blue-600 text-white rounded">
      Drug Substance
    </button>

    <button onclick="selectMainSection('dp')"
      class="px-4 py-2 bg-green-600 text-white rounded">
      Drug Product
    </button>
  </div>

  <!-- SUB-SECTION SELECTOR -->
  <div id="subSectionSelector" class="flex space-x-4 mb-6 hidden">
    <button onclick="loadSubSection('core')"
      class="px-4 py-2 bg-gray-700 text-white rounded">Core</button>

    <button onclick="loadSubSection('stability')"
      class="px-4 py-2 bg-purple-600 text-white rounded">Stability</button>

    <button id="sterilityBtn"
      onclick="loadSubSection('sterility')"
      class="px-4 py-2 bg-red-600 text-white rounded">Sterility</button>
  </div>

  <!-- QUESTION AREA -->
  <div id="questionArea" class="bg-white p-6 rounded shadow hidden">
    <h2 id="sectionTitle" class="text-xl font-semibold mb-4"></h2>
    <p id="questionText" class="mb-4 text-gray-700"></p>

    <select id="answer" class="border p-2 rounded w-full mb-4">
      <option value="">Select answer</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
      <option value="NA">Not Applicable</option>
    </select>

    <button onclick="nextQuestion()"
      class="bg-black text-white px-4 py-2 rounded">
      Next
    </button>
  </div>

  <!-- RESULT -->
  <div id="resultArea" class="mt-6 bg-white p-6 rounded shadow hidden">
    <h2 class="text-xl font-semibold mb-2">Result</h2>
    <pre id="resultText" class="text-red-600"></pre>
  </div>

  <!-- AUDIT LOG -->
  <div id="auditArea" class="mt-6 bg-white p-6 rounded shadow hidden">
    <h2 class="text-xl font-semibold mb-2">Audit Log (ALCOA+)</h2>
    <pre id="auditText" class="text-sm text-gray-700"></pre>

    <button id="auditDownloadBtn"
      onclick="downloadAuditLog()"
      class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hidden">
      Download Audit Log
    </button>
  </div>

</div>

<script>
/* ========== AUTHORIZED USERS (EDIT THIS) ========== */
const AUTHORIZED_USERS = {
  "qa_user_01": { key: "QA123", role: "QA" },
  "ra_user_26": { key: "Ra@2026", role: "RA" },
  "RA-MANG":   { key: "Admin@2026", role: "RA-MANG" }
};

/* ========== STATE ========== */
let currentRole = "";
let rules = [];
let index = 0;
let deficiencies = [];
let auditLog = [];
let mainSection = "";
let subSection = "";

/* ========== ACCESS CONTROL ========== */
function validateAccess() {
  const id = document.getElementById("accessId").value;
  const key = document.getElementById("accessKey").value;

  if (!AUTHORIZED_USERS[id] || AUTHORIZED_USERS[id].key !== key) {
    document.getElementById("accessError").classList.remove("hidden");
    return;
  }

  currentRole = AUTHORIZED_USERS[id].role;

  auditLog.push({
    event: "ACCESS_GRANTED",
    user: id,
    role: currentRole,
    timestamp: new Date().toISOString()
  });

  document.getElementById("accessGate").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  if (currentRole === "ADMIN") {
    document.getElementById("auditDownloadBtn").classList.remove("hidden");
  }
}

/* ========== EXISTING LOGIC CONTINUES (UNCHANGED) ========== */

function selectMainSection(section) {
  mainSection = section;
  subSection = "";

  document.getElementById("subSectionSelector").classList.remove("hidden");
  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("resultArea").classList.add("hidden");
  document.getElementById("auditArea").classList.add("hidden");

  const sterilityBtn = document.getElementById("sterilityBtn");
  section === "ds" ? sterilityBtn.classList.add("hidden") : sterilityBtn.classList.remove("hidden");
}

/* (loadSubSection, showQuestion, nextQuestion, showResult, downloadAuditLog remain as before) */
</script>

</body>
</html>
