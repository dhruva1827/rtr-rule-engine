<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FDA RTR – Module 3</title>

  <!-- Tailwind CSS (FREE, COMMERCIAL USE OK) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<div class="max-w-4xl mx-auto p-6">

  <h1 class="text-3xl font-bold mb-6 text-gray-800">
    FDA RTR – CTD Module 3 Checker
  </h1>

  <!-- SECTION SELECTOR -->
  <div class="flex space-x-4 mb-6">
    <button onclick="loadSection('ds')"
      class="px-4 py-2 bg-blue-600 text-white rounded">
      Drug Substance
    </button>

    <button onclick="loadSection('dp')"
      class="px-4 py-2 bg-green-600 text-white rounded">
      Drug Product
    </button>
  </div>

  <!-- QUESTION AREA -->
  <div id="questionArea" class="bg-white p-6 rounded shadow hidden">
    <h2 id="sectionTitle" class="text-xl font-semibold mb-4"></h2>

    <p id="questionText" class="mb-4 text-gray-700"></p>

    <select id="answer"
      class="border p-2 rounded w-full mb-4">
      <option value="">Select answer</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
      <option value="NA">Not Applicable</option>
    </select>

    <button onclick="nextQuestion()"
      class="bg-black text-white px-4 py-2 rounded">
      Next
    </button>
  </div>

  <!-- RESULT -->
  <div id="resultArea" class="mt-6 bg-white p-6 rounded shadow hidden">
    <h2 class="text-xl font-semibold mb-2">Result</h2>
    <pre id="resultText" class="text-red-600"></pre>
  </div>

</div>

<script>
let rules = [];
let index = 0;
let deficiencies = [];

function loadSection(section) {
  fetch(section === 'ds' ? 'rules_ds.json' : 'rules_dp.json')
    .then(res => res.json())
    .then(data => {
      rules = data.rules;
      index = 0;
      deficiencies = [];
      document.getElementById("resultArea").classList.add("hidden");
      document.getElementById("questionArea").classList.remove("hidden");
      showQuestion(section);
    });
}

function showQuestion(section) {
  if (index >= rules.length) {
    showResult();
    return;
  }

  const rule = rules[index];
  document.getElementById("sectionTitle").innerText =
    section === 'ds' ? "Drug Substance" : "Drug Product";
  document.getElementById("questionText").innerText =
    rule.regulatory_expectation;
}

function nextQuestion() {
  const ans = document.getElementById("answer").value;
  if (!ans) {
    alert("Please select an answer");
    return;
  }

  const rule = rules[index];

  if (ans === "No" && rule.mandatory) {
    deficiencies.push({
      section: rule.ctd_section,
      issue: rule.regulatory_expectation,
      severity: rule.severity_if_missing
    });
  }

  document.getElementById("answer").value = "";
  index++;
  showQuestion();
}

function showResult() {
  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("resultArea").classList.remove("hidden");

  let text = "";
  if (deficiencies.length === 0) {
    text = "No RTR-triggering deficiencies identified.";
  } else {
    deficiencies.forEach(d => {
      text +=
        "Section: " + d.section + "\n" +
        "Issue: " + d.issue + "\n" +
        "Severity: " + d.severity + "\n\n";
    });
    text += "FINAL DECISION: REFUSE TO RECEIVE";
  }

  document.getElementById("resultText").innerText = text;
}
</script>

</body>
</html>
